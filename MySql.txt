
CREATE DATABASE IF NOT EXISTS 	sgip;
USE sgip;

CREATE TABLE categoria (
    id_categoria INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    descripcion TEXT
);

CREATE TABLE usuario (
    id_usuario INT AUTO_INCREMENT PRIMARY KEY,
    correo VARCHAR(191) UNIQUE NOT NULL,
    contrase単a VARCHAR(255) NOT NULL,
    nombre VARCHAR(100) NOT NULL,
    rol ENUM('admin', 'usuario') DEFAULT 'usuario'
);

CREATE TABLE articulo (
    id_articulo INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(255) NOT NULL,
    descripcion TEXT,
    precio DECIMAL(10,2) NOT NULL,
    id_usuario INT NOT NULL,
    id_categoria INT NOT NULL,
    estado TINYINT(1) DEFAULT 1,   -- 1 = activo, 0 = inactivo
    fecha_registro DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (id_usuario) REFERENCES Usuario(id_usuario),
    FOREIGN KEY (id_categoria) REFERENCES categoria(id_categoria)
);

CREATE TABLE facturas (
    id_factura INT AUTO_INCREMENT PRIMARY KEY,
    fecha DATE NOT NULL,
    ruta_factura VARCHAR(500),
    id_articulo INT NOT NULL,
    FOREIGN KEY (id_articulo) REFERENCES articulo(id_articulo)
);


CREATE TABLE imagenes (
    id_imagen INT AUTO_INCREMENT PRIMARY KEY,
    id_articulo INT NOT NULL,
    ruta_imagen VARCHAR(500) NOT NULL,
    nombre_archivo VARCHAR(255) NOT NULL,
    FOREIGN KEY (id_articulo) REFERENCES articulo(id_articulo)
);

-- Script para actualizar la base de datos SGIP con los nuevos campos
USE sgip;

-- 1. Agregar campo descripcion a la tabla articulo
ALTER TABLE articulo 
ADD COLUMN descripcion TEXT AFTER nombre;

-- 2. Agregar campo fecha_registro a la tabla articulo si no existe
ALTER TABLE articulo 
ADD COLUMN fecha_registro DATETIME DEFAULT CURRENT_TIMESTAMP AFTER estado;

-- Verificar los cambios
DESCRIBE articulo;

-- Mostrar algunos datos de ejemplo
SELECT id_articulo, nombre, descripcion, precio, estado, fecha_registro FROM articulo LIMIT 5;




USE sgip;

DELIMITER //

CREATE PROCEDURE actualizarUsuario(
    IN p_nombre VARCHAR(255),
    IN p_correo VARCHAR(255),
    IN p_rol VARCHAR(50),
    IN p_estado INT,
    IN p_id_usuario INT
)
BEGIN
    UPDATE usuario
    SET nombre = p_nombre,
        correo = p_correo,
        rol = p_rol,
        estado = p_estado
    WHERE id_usuario = p_id_usuario;
END //

DELIMITER ;




DELIMITER //

CREATE PROCEDURE registrarUsuario(
    IN p_nombre VARCHAR(255),
    IN p_correo VARCHAR(255),
    IN p_contrase単a VARCHAR(255),
    IN p_rol VARCHAR(50),
    IN p_estado INT
)
BEGIN
    INSERT INTO usuario (nombre, correo, contrase単a, rol, estado)
    VALUES (p_nombre, p_correo, p_contrase単a, p_rol, p_estado);
END //

DELIMITER ;

